# CC Marketplace for Claude Code

[English version](README.md)

本リポジトリは Claude Code のマーケットプレイスバンドル（cc-marketplace）を提供します。

同梱プラグイン：

- [`statusline`](#statusline-プラグイン): ブランチ・モデル・コスト・所要時間・差分行数・オプションで名言を表示するシェル用ステータスラインをインストール
- [`gh`](#gh-プラグイン): 変更を分析し、適切に構造化された PR を自動生成するプラグイン
- [`git`](#git-プラグイン): git-flow スタイルのコミットメッセージ自動生成と自動プッシュを行う Git ワークフロー自動化ツール

## 機能

### statusline プラグイン

- **豊富なセッション情報**: ブランチ、モデル、コスト、所要時間、変更行数を表示
- **リアルタイム更新**: Claude Code セッション中にリアルタイムで更新
- **名言表示**: 5 分ごとに新しいプログラミング名言を表示（キャッシュ機能付き、`--no-quotes`で無効化可能）
- **カラー表示**: 絵文字とカラーコードで視覚的に見やすく表示
- **カスタマイズ可能な表示**: オプションの`--no-quotes`フラグで名言なしのクリーンなステータスライン表示が可能

### gh プラグイン

- **インテリジェント分析**: git の変更、コミット、差分を自動的に分析
- **スマートな PR 生成**: 適切なフォーマットで包括的な PR 説明を作成
- **柔軟なオプション**: ドラフト PR、カスタムベースブランチ、レビュアー指定をサポート
- **エラーハンドリング**: 明確なエラーメッセージと実行可能な解決策を提供
- **GitHub 統合**: GitHub CLI (`gh`) とシームレスに統合

### git プラグイン

- **Git-Flow スタイルのコミット**: git-flow 標準に従った Conventional Commit メッセージを自動生成
- **スマートなタイプ検出**: 変更内容を分析し、コミットタイプ（feat、fix、docs など）を自動判定
- **スコープ提案**: 変更されたファイルやディレクトリに基づいて適切なスコープを提案
- **シークレットスキャン**: コミット前に潜在的な機密情報をスキャン
- **自動プッシュ**: コミット後にオプションでリモートへ自動プッシュ
- **対話型ワークフロー**: 各ステップ実行前に確認を求める

## 必要要件

### statusline プラグイン用

- [Claude Code](https://claude.ai/download) がインストール済み
- `jq` がインストールされ `PATH` から実行可能（JSON 解析用）
- `curl` がインストール済み（名言取得用、オプション）
- git リポジトリ（ブランチ表示用、オプション）

### gh プラグイン用

- [Claude Code](https://claude.ai/download) がインストール済み
- `git` がインストールされ `PATH` から実行可能
- [GitHub CLI (`gh`)](https://cli.github.com/) がインストールされ認証済み
- PR を作成する変更がある git リポジトリ

### git プラグイン用

- [Claude Code](https://claude.ai/download) がインストール済み
- `git` がインストールされ `PATH` から実行可能
- コミットする変更がある git リポジトリ

## インストール

### GitHub から（推奨）

```bash
/plugin marketplace add setouchi-h/cc-marketplace
# statusline プラグインのインストール
/plugin install statusline@cc-marketplace
# gh プラグインのインストール
/plugin install gh@cc-marketplace
# git プラグインのインストール
/plugin install git@cc-marketplace
```

---

## statusline プラグイン

### 概要

statusline プラグインは、Claude Code セッションに関する豊富な情報を表示するカスタマイズ可能なステータスラインスクリプトをインストールします。現在の git ブランチ、AI モデル、セッションコスト、所要時間、変更行数、プログラミング名言などを表示します。

### 表示内容

ステータスラインには以下の情報が表示されます：

- 🌿 **現在のブランチ**: Git ブランチ名（例：`main`、`feature/new-ui`）
- 🤖 **モデル**: AI モデル名と ID（例：`Sonnet 4.5`）
- 💰 **コスト**: セッション全体のコスト（USD）（例：`$0.0123`）
- ⏱️ **所要時間**: セッションの経過時間（分/秒）（例：`1m49s`）
- 📝 **変更**: 追加/削除された行数（例：`+10/-2`）
- 💬 **名言**: ランダムなプログラミング名言（5 分ごとに更新）

出力例：

![Statusline Example](assets/statusline.png)

### インストール

#### ステップ 1: プラグインのインストール

```bash
/plugin marketplace add setouchi-h/cc-marketplace
/plugin install statusline@cc-marketplace
```

#### ステップ 2: インストールコマンドの実行

```bash
/statusline:install-statusline
```

このコマンドは以下を実行します：

- `jq` がインストールされているか確認（JSON 解析に必要）
- `~/.claude/scripts/` ディレクトリが存在しない場合は作成
- `~/.claude/scripts/statusline.sh` にステータスラインスクリプトを書き込み
- スクリプトを実行可能にする
- `~/.claude/settings.json` を自動的に設定してステータスラインを有効化

#### ステータスラインのプレビュー

フルセッションを開始せずにステータスラインをテストします：

```bash
/statusline:preview-statusline
```

これにより、モックデータを使用してサンプルのステータスラインがレンダリングされ、色とレイアウトを確認できます。

### 設定オプション

#### 名言の非表示化

名言なしのクリーンなステータスラインが好みの場合は、`--no-quotes` フラグを追加して無効化できます：

1. `~/.claude/settings.json` を開く
2. `statusLine` コマンドを更新：

```json
{
  "statusLine": {
    "type": "command",
    "command": "bash ~/.claude/scripts/statusline.sh --no-quotes"
  }
}
```

3. Claude Code を再起動するか、新しいセッションを開始

`--no-quotes` を指定した場合、ステータスラインは以下のように表示されます：
```
🌿 branch | 🤖 Model | 💰 $0.0123 | ⏱️ 1m49s | 📝 +10/-2
```

`--no-quotes` なし（デフォルト）の場合、名言が含まれます：
```
🌿 branch | 🤖 Model | 💰 $0.0123 | ⏱️ 1m49s | 📝 +10/-2 | 💬 "Code is poetry" - Anonymous
```

#### 設定のテスト

名言の有無でステータスラインをプレビューできます：

```bash
# 名言あり（デフォルト）
/statusline:preview-statusline

# 名言なし
/statusline:preview-statusline --no-quotes
```

### 動作の仕組み

1. **JSON 入力**: Claude Code がセッションデータを JSON として標準入力経由でスクリプトに渡します
2. **データ抽出**: スクリプトは `jq` を使用して以下を解析します：
   - セッションのコストと所要時間
   - 追加/削除された行数
   - モデル名と ID
   - ワークスペースディレクトリ
3. **Git ブランチ**: ワークスペースから現在の git ブランチを検出
4. **名言の取得**:
   - [ZenQuotes API](https://zenquotes.io/) からランダムな名言を取得
   - API 呼び出しを減らすため、名言を 5 分間キャッシュ
   - オフライン時はキャッシュまたはデフォルトの名言にフォールバック
5. **フォーマット**: 絵文字と ANSI カラーコードを使用して 1 行を出力

### 必要要件

- **jq**: JSON 解析に必須
  - macOS: `brew install jq`
  - Linux: `sudo apt-get install jq` または `sudo yum install jq`
  - Windows: [jqlang.github.io](https://jqlang.github.io/jq/download/) からダウンロード
- **curl**: 名言の取得に使用（オプション、利用できない場合は適切に動作を低下）
- **git**: ブランチ名の表示に使用（オプション）

---

## gh プラグイン

### 基本的な使い方

Claude Code でコマンドを実行するだけです：

```bash
/gh:create-pr
```

プラグインは以下を実行します：

1. 現在のブランチと変更を分析
2. 包括的な PR タイトルと説明を生成
3. 必要に応じてブランチをプッシュ
4. GitHub でプルリクエストを作成
5. PR URL を表示

### フラグ

- `-d, --draft`: ドラフト PR として作成
- `-b, --base <branch>`: 既定のベースブランチの代わりに使用（既定はリポジトリのデフォルトブランチ。一般的に `main` または `master`）
- `-r, --reviewer <user>`: 指定した GitHub ユーザーをレビュアーに追加。複数追加する場合はフラグを繰り返し指定
- `--no-push`: PR 作成前のブランチのプッシュをスキップ
- `--no-assign`: 自分自身へのアサインをスキップ。デフォルトでは、PR は認証ユーザー（`@me`）にアサインされます。アサインは PR 作成後に実行され、権限がない場合は警告のみ表示し、PR 作成自体は成功のままにします。

短縮形を使った例：

```bash
# カスタムベースのドラフトPR。レビュアーを2名追加
/create-pr -d -b develop -r alice -r bob
```

### 動作の仕組み

1. **ブランチ分析**: 現在のブランチステータスとリモートトラッキングを確認
2. **変更検出**: ベースブランチからのコミットと差分を分析
3. **コンテンツ生成**: 以下を含む PR を作成：
   - 簡潔で説明的なタイトル（命令形、72 文字未満）
   - 包括的な説明：
     - 変更の概要
     - 詳細な変更リスト
     - 動機と文脈
     - テスト情報
     - 追加の注記
4. **PR 作成**: `gh pr create` を使用してプルリクエストを作成
5. **結果表示**: PR URL と概要を表示

### 権限

このプラグインは以下のローカルコマンドを呼び出します：

- `git` — ステータス、ブランチ、コミット、差分の取得のため
- `gh` — GitHub CLI を用いたプルリクエスト作成のため

既存の `gh auth login` セッションに依存し、認証情報をプラグイン側で保存しません。

### PR 説明の例

プラグインは以下の構造で PR を生成します：

```markdown
## Summary

この PR が達成する内容の簡単な概要

## Changes

- 主な変更や機能 1
- 主な変更や機能 2
- 主な変更や機能 3

## Motivation

これらの変更が必要な理由の説明

## Testing

- 変更がどのようにテストされたか
- テスト結果または検証手順

## Notes

追加の文脈、破壊的変更、またはレビュアーへの注記
```

---

## git プラグイン

### 概要

git プラグインは、git-flow スタイルの Conventional Commit メッセージを使用して git コミットワークフローを自動化します。変更内容を分析し、適切なコミットメッセージを生成し、オプションでリモートリポジトリへプッシュします。

### 基本的な使い方

Claude Code でコマンドを実行するだけです：

```bash
/git:commit
```

プラグインは以下を実行します：

1. ステージング済みおよび未ステージングの変更を分析
2. 適切なコミットタイプ（feat、fix、docs など）を検出
3. 変更されたファイルに基づいてスコープを提案
4. git-flow スタイルのコミットメッセージを生成
5. 確認を求める
6. コミットを作成
7. リモートへプッシュ（--no-push が指定されていない場合）

### コミットタイプ

プラグインは Conventional Commit のタイプを使用します：

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: フォーマット、空白、セミコロンの欠落など
- `refactor`: バグ修正でも機能追加でもないコード変更
- `perf`: パフォーマンス改善
- `test`: テストの追加または修正
- `chore`: ビルドプロセス、ツール、ライブラリの更新
- `ci`: CI/CD 設定の変更

### フラグ

- `--no-push`: コミット作成後にリモートへプッシュしない
- `--scope <scope>`: コミットスコープを手動で指定（例：「auth」、「api」）
- `--type <type>`: 自動検出の代わりに特定のコミットタイプを強制

使用例：

```bash
# 自動検出してプッシュ
/git:commit

# プッシュせずにコミット
/git:commit --no-push

# 特定のタイプとスコープを強制
/git:commit --type feat --scope auth

# スコープのみ指定
/git:commit --scope api
```

### コミットメッセージ形式

生成されるコミットメッセージは Conventional Commit 形式に従います：

```
<type>(<scope>): <subject>

<body>

<footer>
```

例：

```
feat(auth): OAuth2 認証フローを追加

Google と GitHub プロバイダを使った OAuth2 認証を実装。
トークン更新メカニズムとセッション管理を追加。

Closes #123
```

### 動作の仕組み

1. **コンテキスト収集**: 現在のブランチ、ステージング済み/未ステージングの変更、最近のコミットを分析
2. **変更分析**: 以下に基づいてコミットタイプを判定：
   - 変更されたファイル（例：`*.md` ファイル → `docs`）
   - 差分の内容（例：テストファイル → `test`）
   - ディレクトリ構造（例：`.github/` → `ci`）
3. **スコープ検出**: 以下からスコープを提案：
   - パッケージ名（例：`packages/auth` → スコープ：`auth`）
   - ディレクトリ名
   - モジュール名
4. **シークレットスキャン**: 潜在的な機密情報をチェック：
   - API キー（AKIA、ghp_、sk- など）
   - プライベートキー
   - トークンとパスワード
   - 機密性の高い環境ファイル
5. **ステージング**: 必要に応じて未ステージングのファイルをステージング
6. **コミット作成**: 生成されたメッセージでコミットを作成
7. **プッシュ**: 適切なアップストリームトラッキングでリモートへプッシュ

### セキュリティ機能

プラグインには以下をチェックする組み込みのシークレットスキャンが含まれています：

- API キーとトークン
- プライベートキー（RSA、SSH など）
- パスワードと認証情報
- 機密データパターン

疑わしい内容が検出された場合、プラグインは：
- マスクされたスニペットと共に警告を表示
- 明示的な確認を求める
- デフォルトでコミットをキャンセル

### ワークフロー例

```
あなた: /git:commit

Claude: 変更を分析し、以下を検出しました：
- タイプ: feat（新機能を検出）
- スコープ: auth（packages/auth/ の変更に基づく）
- ファイル: 3 ファイル変更、45 行追加(+)、12 行削除(-)

提案されたコミットメッセージ：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
feat(auth): OAuth2 認証フローを追加

Google と GitHub プロバイダを使った OAuth2 認証を実装。
トークン更新メカニズムとセッション管理を追加。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

このコミットメッセージで続行しますか？（yes/no/edit）

あなた: yes

Claude: ✓ コミットが正常に作成されました
✓ origin/your-branch へプッシュ中...
✓ プッシュが完了しました

概要:
- コミット: feat(auth): OAuth2 認証フローを追加
- ブランチ: your-branch
- 変更ファイル数: 3
- プッシュ状態: 成功
```

### 権限

このプラグインは以下のローカルコマンドを呼び出します：

- `git status` — 作業ツリーの状態を確認
- `git diff` — 変更を分析
- `git add` — ファイルをステージング
- `git commit` — コミットを作成
- `git push` — リモートへプッシュ
- `git branch` — 現在のブランチを取得
- `git log` — 最近のコミットパターンを分析

認証情報を保存せず、既存の git 設定を使用します。

## 貢献

貢献を歓迎します！Issue や Pull Request をお気軽に送信してください。

1. リポジトリをフォーク
2. フィーチャーブランチを作成
3. 変更をコミット
4. ブランチにプッシュ
5. Pull Request を作成

## ライセンス

MIT License - 詳細は [LICENSE](LICENSE) ファイルを参照してください
